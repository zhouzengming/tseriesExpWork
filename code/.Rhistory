# 两参数平滑拟合效果
plot(x.fit)
#预测序列并绘制预测效果图
x.fore<-forecast(x.fit,h=10)
x.fore
plot(x.fore)
#???4 例#读入序列
b<-read.table("E:/R5.csv",sep=",",header = T)
x<-ts(b$milk,start = c(1962,1),frequency = 12)
#进行Holt-winters三参数指数平?平滑it<-HoltWinters(x)
x.fit
# 例4
#读入序列
b<-read.table("R5.csv",sep=",",header = T)
# 例4-6
#读入序列
b<-read.table("file5.csv",sep=",",header = T)
x<-ts(b$milk,start = c(1962,1),frequency = 12)
#进行Holt-winters三参数指数平?平滑it<-HoltWinters(x)
x.fit
#绘制Holt-winters三参数指数平滑拟合效果图
plot(x.fit)
#预测序列并绘制预测效果图
x.fore<-forecast(x.fit,h=24)
plot(x.fore)
#???4 例#读入序列,并绘制时序图
c<-read.table("E:/R14.csv",sep=",",header = T)
# 例4-8
#读入序列,并绘制时序图
c<-read.table("file14.csv",sep=",",header = T)
x<-ts(c$sales,start = c(1993,1),frequency = 12)
plot(x)
#确定性因素分解
x.fit<-decompose(x,type="mult")
#查看季节指数，并绘制季节指数图
x.fit$figure
plot(x.fit$figure,type = "o")
#查看趋势拟合值，并绘制趋势拟合图
x.fit$trend
plot(x.fit$trend)
#查看随机波动(残差)值，并绘制残差图
x.fit$random
plot(x.fit$random)
#命令集合
x.fit
plot(x.fit)
#unit5
rm(list = ls());gc();
#例5-1
a<-read.table("file4.csv",sep=",",header = T)
x<-ts(a$output,start = 1964)
x.dif<-diff(x)
plot(x.dif)
#例5-2
#读入数据，并绘制时序图
b<-read.table("file15.csv",sep=",",header = T)
x<-ts(b$vehicle,start = 1950)
plot(x)
# 1阶差分，并绘制出差分后序列的时序图
x.dif<-diff(x)
plot(x.dif)
# 2阶差分，并绘制出差分后序列的时序图
x.dif2<-diff(x,1,2)
plot(x.dif2)
# 例5-3
# 读入数据，并绘制时序图
c<-read.table("file16.csv",sep=",",header = T)
x<-ts(c$export,start = c(2001,1),frequency = 12)
plot(x)
# 1阶差分，并绘制出差分后序列的时序图
x.dif<-diff(x)
plot(x.dif)
# 1阶差分加12步差分，并绘制出差分后序列的时序图
x.dif1_12<-diff(diff(x),12)
plot(x.dif1_12)
x<-arima.sim(n=1000,list(order=c(0,1,0)),sd=10)
plot(x)
#例5-5
x<-arima.sim(n=1000,list(order=c(0,1,0)),sd=10)
plot(x)
#例5-6
#读入数据，并绘制时序图
d<-read.table("file17.csv",sep=",",header = T)
x<-ts(d$index,start = 1952)
plot(x)
#1阶差分，并绘制出差分后序列的时序图
x.dif<-diff(x)
plot(x.dif)
#绘制差分后序列自相关图和偏自相关图
acf(x.dif)
pacf(x.dif)
#拟合ARIMA(0,1,1)模型
x.fit<-arima(x,order=c(0,1,1))
x.fit
#残差白噪声检验
for(i in 1:2) print(Box.test(x.fit$residual,lag=6*i))
#例5-6 续(1)
library(zoo)
library(forecast)
d<-read.table("file17.csv",sep=",",header = T)
x<-ts(d$index,start = 1952)
x.fit<-arima(x,order=c(0,1,1))
x.fore<-forecast(x.fit,h=10)
plot(x.fore)
#例5-8
#读入数据，并绘制时序图
e<-read.table("file18.csv",sep=",",header = T)
x<-ts(e$fertility,start = 1917)
plot(x)
#1阶差分，并绘制出差分后序列的时序图
x.dif<-diff(x)
plot(x.dif)
#绘制差分后序列自相关图和偏自相关图
acf(x.dif)
pacf(x.dif)
#拟合疏系数模型ARIMA((1,4),1,0)
x.fit<-arima(x,order = c(4,1,0),transform.pars = F,fixed = c(NA,0,0,NA))
x.fit
#残差白噪声检验
for(i in 1:2) print(Box.test(x.fit$residual,lag=6*i))
#做5期预测，并绘制预测图
x.fore<-forecast(x.fit,h=5)
x.fore
plot(x.fore)
#例5-9
#读入数据，并绘制时序图
f<-read.table("file19.csv",sep=",",header = T)
x<-ts(f$unemployment_rate,start = c(1962,1),frequency = 4)
plot(x)
#1阶4步差分，并绘制出差分后序列的时序图
x.dif<-diff(diff(x),4)
plot(x.dif)
#绘制差分后序列自相关图和偏自相关图
acf(x.dif)
pacf(x.dif)
#拟合加法季节模型ARIMA((1,4),(1,4),0)
x.fit<-arima(x,order = c(4,1,0),seasonal = list(order=c(0,1,0),period=4,transform.par=F,fixed = c(NA,0,0,NA)))
x.fit
#残差白噪声检验
for(i in 1:2) print(Box.test(x.fit$residual,lag=6*i))
#做3年期预测，并绘制预测图
x.fore<-forecast(x.fit,h=12)
x.fore
plot(x.fore)
#例5-10
#读入数据，并绘制时序图
g<-read.table("file20.csv",sep=",",header = T)
x<-ts(g$unemployment_rate,start = c(1948,1),frequency = 12)
plot(x)
#作1阶12步差分，并绘制出差分后序列的时序图
x.dif<-diff(diff(x),12)
plot(x.dif)
#绘制差分后序列自相关图和偏自相关图
acf(x.dif)
pacf(x.dif)
#拟合ARIMA(1,(1,12),1)模型
x.fit<-arima(x,order = c(1,1,1),seasonal = list(order=c(0,1,0),period=12))
for(i in 1:2) print(Box.test(x.fit$residual,lag=6*i))
#拟合ARIMA(1,1,1)*ARIMA(0,1,1)12模型
x.fit<-arima(x,order = c(1,1,1),seasonal = list(order=c(0,1,1),period=12))
x.fit
#残差序列白噪声检验
for(i in 1:2) print(Box.test(x.fit$residual,lag=6*i))
#例5-6 续(2)
#拟合关于时间t的线性回归模型
d<-read.table("file17.csv",sep=",",header = T)
x<-ts(d$index,start = 1952)
t<-c(1:37)
x.fit1<-lm(x~t)
summary(x.fit1)
#拟合关于延迟变量的自回归模型
xlag<-x[2:37]
x2<-x[1:36]
x.fit2<-lm(x2~xlag)
summary(x.fit2)
#两个趋势拟合模型的拟合效果图
fit1<-ts(x.fit1$fitted.value,start = 1952)
fit2<-ts(x.fit2$fitted.value,start = 1952)
plot(x,type = "p",pch=8)
lines(fit1,col=2)
lines(fit2,col=4)
source("/media/zzm/3AAD22D845A051D1/tseries/code/unit5.R")
#unit5
rm(list = ls());gc();
setwd("/media/zzm/3AAD22D845A051D1/tseries/code")
#例5-1
a<-read.table("file4.csv",sep=",",header = T)
x<-ts(a$output,start = 1964)
x.dif<-diff(x)
plot(x.dif)
#例5-2
#读入数据，并绘制时序图
b<-read.table("file15.csv",sep=",",header = T)
x<-ts(b$vehicle,start = 1950)
plot(x)
# 1阶差分，并绘制出差分后序列的时序图
x.dif<-diff(x)
plot(x.dif)
# 2阶差分，并绘制出差分后序列的时序图
x.dif2<-diff(x,1,2)
plot(x.dif2)
# 例5-3
# 读入数据，并绘制时序图
c<-read.table("file16.csv",sep=",",header = T)
x<-ts(c$export,start = c(2001,1),frequency = 12)
plot(x)
# 1阶差分，并绘制出差分后序列的时序图
x.dif<-diff(x)
plot(x.dif)
# 1阶差分加12步差分，并绘制出差分后序列的时序图
x.dif1_12<-diff(diff(x),12)
plot(x.dif1_12)
x<-arima.sim(n=1000,list(order=c(0,1,0)),sd=10)
plot(x)
#例5-5
x<-arima.sim(n=1000,list(order=c(0,1,0)),sd=10)
plot(x)
#例5-6
#读入数据，并绘制时序图
d<-read.table("file17.csv",sep=",",header = T)
x<-ts(d$index,start = 1952)
plot(x)
#1阶差分，并绘制出差分后序列的时序图
x.dif<-diff(x)
plot(x.dif)
#绘制差分后序列自相关图和偏自相关图
acf(x.dif)
pacf(x.dif)
#拟合ARIMA(0,1,1)模型
x.fit<-arima(x,order=c(0,1,1))
x.fit
#残差白噪声检验
for(i in 1:2) print(Box.test(x.fit$residual,lag=6*i))
#例5-6 续(1)
library(zoo)
library(forecast)
d<-read.table("file17.csv",sep=",",header = T)
x<-ts(d$index,start = 1952)
x.fit<-arima(x,order=c(0,1,1))
x.fore<-forecast(x.fit,h=10)
plot(x.fore)
#例5-8
#读入数据，并绘制时序图
e<-read.table("file18.csv",sep=",",header = T)
x<-ts(e$fertility,start = 1917)
plot(x)
#1阶差分，并绘制出差分后序列的时序图
x.dif<-diff(x)
plot(x.dif)
#绘制差分后序列自相关图和偏自相关图
acf(x.dif)
pacf(x.dif)
#拟合疏系数模型ARIMA((1,4),1,0)
x.fit<-arima(x,order = c(4,1,0),transform.pars = F,fixed = c(NA,0,0,NA))
x.fit
#残差白噪声检验
for(i in 1:2) print(Box.test(x.fit$residual,lag=6*i))
#做5期预测，并绘制预测图
x.fore<-forecast(x.fit,h=5)
x.fore
plot(x.fore)
#例5-9
#读入数据，并绘制时序图
f<-read.table("file19.csv",sep=",",header = T)
x<-ts(f$unemployment_rate,start = c(1962,1),frequency = 4)
plot(x)
#1阶4步差分，并绘制出差分后序列的时序图
x.dif<-diff(diff(x),4)
plot(x.dif)
#绘制差分后序列自相关图和偏自相关图
acf(x.dif)
pacf(x.dif)
#拟合加法季节模型ARIMA((1,4),(1,4),0)
x.fit<-arima(x,order = c(4,1,0),seasonal = list(order=c(0,1,0),period=4,transform.par=F,fixed = c(NA,0,0,NA)))
x.fit
#残差白噪声检验
for(i in 1:2) print(Box.test(x.fit$residual,lag=6*i))
#做3年期预测，并绘制预测图
x.fore<-forecast(x.fit,h=12)
x.fore
plot(x.fore)
#例5-10
#读入数据，并绘制时序图
g<-read.table("file20.csv",sep=",",header = T)
x<-ts(g$unemployment_rate,start = c(1948,1),frequency = 12)
plot(x)
#作1阶12步差分，并绘制出差分后序列的时序图
x.dif<-diff(diff(x),12)
plot(x.dif)
#绘制差分后序列自相关图和偏自相关图
acf(x.dif)
pacf(x.dif)
#拟合ARIMA(1,(1,12),1)模型
x.fit<-arima(x,order = c(1,1,1),seasonal = list(order=c(0,1,0),period=12))
for(i in 1:2) print(Box.test(x.fit$residual,lag=6*i))
#拟合ARIMA(1,1,1)*ARIMA(0,1,1)12模型
x.fit<-arima(x,order = c(1,1,1),seasonal = list(order=c(0,1,1),period=12))
x.fit
#残差序列白噪声检验
for(i in 1:2) print(Box.test(x.fit$residual,lag=6*i))
#例5-6 续(2)
#拟合关于时间t的线性回归模型
d<-read.table("file17.csv",sep=",",header = T)
x<-ts(d$index,start = 1952)
t<-c(1:37)
x.fit1<-lm(x~t)
summary(x.fit1)
#拟合关于延迟变量的自回归模型
xlag<-x[2:37]
x2<-x[1:36]
x.fit2<-lm(x2~xlag)
summary(x.fit2)
#两个趋势拟合模型的拟合效果图
fit1<-ts(x.fit1$fitted.value,start = 1952)
fit2<-ts(x.fit2$fitted.value,start = 1952)
plot(x,type = "p",pch=8)
lines(fit1,col=2)
lines(fit2,col=4)
#例5-6 续(3)
library(lmtest)
dwtest(x.fit1)
dwtest(x.fit2,order.by=xlag)
#例5-6 续(5)
#绘制差分后序列自相关图和偏自相关图
acf(x.fit1$residual)
pacf(x.fit1$residual)
#拟合AR(2)模型
r.fit<-arima(x.fit1$residual,order=c(2,0,0),include.mean = F)
r.fit
#残差自相关模型的显著性检验
for(i in 1:2) print(Box.test(r.fit$residual,lag=6*i))
#例5-11
#读入数据，并绘制时序图
h<-read.table("file21.csv",sep=",",header = T)
x<-ts(h$yield_rate,start = c(1963,4),frequency = 12)
plot(x)
#作1阶差分，并绘制出差分后残差序列时序图
x.dif<-diff(x)
plot(x.dif)
#绘制1阶差分后残差平方图
plot(x.dif^2)
#例5-11 续
#作对数变换，并绘制对数变换后时序图
lnx<-log(x)
plot(lnx)
#作1阶差分，并绘制出差分后序列时序图
dif.lnx<-diff(lnx)
plot(dif.lnx)
#残差白噪声检验
for(i in 1:2) print(Box.test(dif.lnx,lag=6*i))
#例5-12
#读入数据，并绘制时序图
k<-read.table("file22.csv",sep=",",header = T)
x<-ts(k$returns,start = c(1926,1),frequency = 12)
plot(x)
#绘制序列平方图
plot(x^2)
#例5-12 续
#LM检验
for(i in 1:5) print(ArchTest(x,lag=i))
#Portmanteau Q检验
for(i in 1:2) print(Box.test(x^2,lag=i))
#例5-12
#读入数据，并绘制时序图
k<-read.table("file22.csv",sep=",",header = T)
x<-ts(k$returns,start = c(1926,1),frequency = 12)
plot(x)
#绘制序列平方图
plot(x^2)
#例5-12 续
#LM检验
for(i in 1:5) print(ArchTest(x,lag=i))
library(FinTS)
install.packages("FinTS")
#例5-12 续
library(FinTS)
#LM检验
for(i in 1:5) print(ArchTest(x,lag=i))
#Portmanteau Q检验
for(i in 1:2) print(Box.test(x^2,lag=i))
#拟合ARCH(3)模型
x.fit<-garch(x,order=c(0,3))
summary(x.fit)
#绘制条件异方差模型拟合的95%置信区间
x.pred<-predict(x.fit)
plot(x.pred)
#条件异方差置信区间和方差齐性置信区间比较图示
plot(x)
lines(x.pred[,1],col=2)
lines(x.pred[,2],col=2)
abline(h=1.96*sd(x),col=4,lty=2)
abline(h=-1.96*sd(x),col=4,lty=2)
#5.6.2 GARCH模型
#例5-13
#读入数据，并绘制时序图
w<-read.table("file23.csv",sep=",",header = T)
x<-ts(w$exchange_rates,start=c(1979,12,31),frequency = 365)
plot(x)
#对差分序列性质考察
plot(diff(x))
acf(diff(x))
pacf(diff(x))
#水平相关信息提取，拟合ARIMA(0,1,1)模型
x.fit<-arima(x,order = c(0,1,1))
x.fit
#残差白噪声检验
for (i in 1:6) print(Box.test(x.fit$residual,type = "Ljung-Box",lag=i))
#水平预测，并绘制预测图
x.fore<-forecast(x.fit,h=365)
plot(x.fore)
#条件异方差检验(Portmanteau Q检验)
for (i in 1:6) print(Box.test(x.fit$residual^2,type = "Ljung-Box",lag=i))
#拟合GARCH(1,1)模型
library(tseries)
r.fit<-garch(x.fit$residual,order=c(1,1))
summary(r.fit)
#绘制波动置信区间
r.pred<-predict(r.fit)
plot(r.pred)
source("/media/zzm/3AAD22D845A051D1/tseries/code/unit6.R")
source("/media/zzm/3AAD22D845A051D1/tseries/code/unit6.R")
#unit 6
rm(list = ls());gc();
setwd("/media/zzm/3AAD22D845A051D1/tseries/code")
#例6-1
#读入数据，并绘制输出序列时序图
a<-read.table("file24.csv",sep=",",header = T)
y<-ts(a$output)
plot(y)
#考察输出序列自相关图和偏自相关图
acf(y)
pacf(y)
#对输出序列拟合模型AR(4)
y.fit<-arima(y,order=c(4,0,0))
y.fit
#残差白噪声检验
for (i in 1:2) print(Box.test(y.fit$residual,lag=6*i))
x<-ts(a$input)
library(TSA)
y.fit2<-arima(y,order=c(4,0,0),xtransf = x,transfer = list(c(2,1)))
y.fit2
#例6-2
#拟合带漂移项的差分平稳序列，并绘制时序图和线性拟合效果图
e<-rnorm(1000)
x<-filter(0.1+e,filter = 1,method = "recursive")
plot(x)
t<-c(1:1000)
abline(lm(x~t),col=2)
lm(x~t)
#差分运算和线性拟合后残差序列比较
r1<-diff(x)
x.fit<-lm(x~t)
r2<-ts(x.fit$residual)
c1<-min(r1,r2)
c2<-max(r1,r2)
plot(r1,ylim=c(c1,c2))
lines(r2,col=2)
#例6-3
#拟合趋势平稳序列，并绘制时序图
t<-c(1:1000)
e<-rnorm(1000,0,10)
x<-0.1*t+e
x<-ts(x)
plot(x)
#考察差分后差分序列的波动范围
plot(diff(x))
abline(h=c(1.98*sd(diff(x)),-1.98*sd(diff(x))),col=2)
#考察线性拟合后残差序列的波动范围
x.fit<-lm(x~t)
r<-ts(x.fit$residual)
plot(r)
abline(h=c(1.98*sd(r),-1.98*sd(r)),col=2)
#例6-4
#读入数据，并绘制两序列时序图
b<-read.table("file25.csv",sep=",",header = T)
x<-ts(b$lnx,start = 1978)
y<-ts(b$lny,start = 1978)
c1<-min(x,y)
c2<-max(x,y)
plot(x,ylim=c(c1,c2))
lines(y,lty=2,col=2)
#对人均纯收入对数序列进行DF检验
library(fBasics)
library(fUnitRoots)
adfTest(x,lag=1,type="nc")
adfTest(x,lag=1,type="c")
adfTest(x,lag=1,type="ct")
#对人均生活消费支出对数序列进行DF检验
adfTest(y,lag=1,type="nc")
adfTest(y,lag=1,type="c")
adfTest(y,lag=1,type="ct")
#例6-4续(1)
#差分运算
dx<-diff(x)
dy<-diff(y)
#人均收入对数差分后序列ADF检验
for (i in 1:3) print(adfTest(dx,lag=i,type='nc'))
for (i in 1:3) print(adfTest(dx,lag=i,type='c'))
#人均支出对数差分后序列ADF检验
for (i in 1:3) print(adfTest(dy,lag=i,type='nc'))
for (i in 1:3) print(adfTest(dy,lag=i,type='c'))
#例6-4续(2)
#第一步:构造回归模型
y.fit<-lm(y~x)
summary(y.fit)
#第二步:残差序列单位根检验
r<-ts(y.fit$residual)
for (i in 1:3) print(adfTest(r,lag=i,type='nc'))
#例6-4续(3)
ECM<-y.fit$residual[1:24]
dify.fit<-lm(diff(y)~0+diff(x)+ECM)
summary(dify.fit)
